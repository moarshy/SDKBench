{
  "score": 0.0,
  "tests_passed": 2,
  "tests_failed": 1,
  "tests_total": 3,
  "tests_skipped": 0,
  "duration": 8.724925994873047,
  "error": "1 tests failed",
  "failed_tests": [
    "Migration: Middleware v4\u2192v5 \u203a should use clerkMiddleware instead of authMiddleware"
  ],
  "failure_details": [
    {
      "test_name": "Migration: Middleware v4\u2192v5 \u203a should use clerkMiddleware instead of authMiddleware",
      "file_path": "tests/migration.test.ts",
      "line_number": 11,
      "error_message": "expect(received).not.toContain(expected)",
      "stack_trace": "\n    expect(received).not.toContain(expected) // indexOf\n\n    Expected substring: not \"authMiddleware\"\n    Received string:        \"import { clerkMiddleware, createRouteMatcher } from \\\"@clerk/nextjs/server\\\"\n\n    const isPublicRoute = createRouteMatcher(['/'])\n\n    export default clerkMiddleware((auth, request) => {\n      if (!isPublicRoute(request)) {\n        auth().protect()\n      }\n    })\n\n    export const config = {\n      matcher: [\n        // Skip Next.js internals and all static files, unless found in search params\n        '/((?!_next|[^?]*\\\\\\\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',\n        // Always run for API routes\n        '/(api|trpc)(.*)',\n      ],\n    }\n\n    ## Migration Summary\n\n    ### Key Changes from Clerk v4 to v5:\n\n    1. **Import Changes**:\n       - `authMiddleware` \u2192 `clerkMiddleware`\n       - Added `createRouteMatcher` from `@clerk/nextjs/server`\n\n    2. **Middleware Function Signature**:\n       - v4: `authMiddleware({ publicRoutes: [...] })`\n       - v5: `clerkMiddleware((auth, request) => { ... })`\n\n    3. **Public Routes Handling**:\n       - v4: Defined via `publicRoutes` config option\n       - v5: Use `createRouteMatcher` to define public routes, then conditionally call `auth().protect()` for protected routes\n\n    4. **Route Protection**:\n       - v4: Automatic protection with `publicRoutes` exclusion\n       - v5: Explicit protection using `auth().protect()` for non-public routes\n\n    5. **Matcher Configuration**:\n       - Updated to the recommended v5 matcher pattern that better handles static files and Next.js internals\n\n    ### How It Works:\n\n    - `createRouteMatcher(['/'])` creates a function that checks if the current route matches any public routes\n    - Inside `clerkMiddleware`, we check if the route is NOT public\n    - If it's not public, we call `auth().protect()` to enforce authentication\n    - Public routes (like '/') will be accessible without authentication\n\n    This migration maintains the same functionality as your v4 setup while following Clerk v5's new patterns and best practices.\"\n\n    \u001b[0m \u001b[90m  9 |\u001b[39m     \u001b[36mconst\u001b[39m middleware \u001b[33m=\u001b[39m readFileSync(middlewarePath\u001b[33m,\u001b[39m \u001b[32m'utf-8'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 10 |\u001b[39m     expect(middleware)\u001b[33m.\u001b[39mtoContain(\u001b[32m'clerkMiddleware'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 11 |\u001b[39m     expect(middleware)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoContain(\u001b[32m'authMiddleware'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                            \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 12 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 13 |\u001b[39m\n     \u001b[90m 14 |\u001b[39m   it(\u001b[32m'should use createRouteMatcher for public routes'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (tests/migration.test.ts:11:28)\n\nTest Suites: 1 failed, 1 total\nTests:       1 failed, 2 passed, 3 total\nSnapshots:   0 total\nTime:        1.256 s\nRan all test suites."
    }
  ],
  "raw_output": "\n> clerk-nextjs-app@0.1.0 test\n> jest\n\nts-jest[config] (WARN) \u001b[94mmessage\u001b[0m\u001b[90m TS151001: \u001b[0mIf you have issues related to imports, you should consider setting `esModuleInterop` to `true` in your TypeScript configuration file (usually `tsconfig.json`). See https://blogs.msdn.microsoft.com/typescript/2018/01/31/announcing-typescript-2-7/#easier-ecmascript-module-interoperability for more information.\nFAIL tests/migration.test.ts\n  Migration: Middleware v4\u2192v5\n    \u2715 should use clerkMiddleware instead of authMiddleware (2 ms)\n    \u2713 should use createRouteMatcher for public routes\n    \u2713 should have auth().protect() pattern (1 ms)\n\n  \u25cf Migration: Middleware v4\u2192v5 \u203a should use clerkMiddleware instead of authMiddleware\n\n    expect(received).not.toContain(expected) // indexOf\n\n    Expected substring: not \"authMiddleware\"\n    Received string:        \"import { clerkMiddleware, createRouteMatcher } from \\\"@clerk/nextjs/server\\\"\n\n    const isPublicRoute = createRouteMatcher(['/'])\n\n    export default clerkMiddleware((auth, request) => {\n      if (!isPublicRoute(request)) {\n        auth().protect()\n      }\n    })\n\n    export const config = {\n      matcher: [\n        // Skip Next.js internals and all static files, unless found in search params\n        '/((?!_next|[^?]*\\\\\\\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',\n        // Always run for API routes\n        '/(api|trpc)(.*)',\n      ],\n    }\n\n    ## Migration Summary\n\n    ### Key Changes from Clerk v4 to v5:\n\n    1. **Import Changes**:\n       - `authMiddleware` \u2192 `clerkMiddleware`\n       - Added `createRouteMatcher` from `@clerk/nextjs/server`\n\n    2. **Middleware Function Signature**:\n       - v4: `authMiddleware({ publicRoutes: [...] })`\n       - v5: `clerkMiddleware((auth, request) => { ... })`\n\n    3. **Public Routes Handling**:\n       - v4: Defined via `publicRoutes` config option\n       - v5: Use `createRouteMatcher` to define public routes, then conditionally call `auth().protect()` for protected routes\n\n    4. **Route Protection**:\n       - v4: Automatic protection with `publicRoutes` exclusion\n       - v5: Explicit protection using `auth().protect()` for non-public routes\n\n    5. **Matcher Configuration**:\n       - Updated to the recommended v5 matcher pattern that better handles static files and Next.js internals\n\n    ### How It Works:\n\n    - `createRouteMatcher(['/'])` creates a function that checks if the current route matches any public routes\n    - Inside `clerkMiddleware`, we check if the route is NOT public\n    - If it's not public, we call `auth().protect()` to enforce authentication\n    - Public routes (like '/') will be accessible without authentication\n\n    This migration maintains the same functionality as your v4 setup while following Clerk v5's new patterns and best practices.\"\n\n    \u001b[0m \u001b[90m  9 |\u001b[39m     \u001b[36mconst\u001b[39m middleware \u001b[33m=\u001b[39m readFileSync(middlewarePath\u001b[33m,\u001b[39m \u001b[32m'utf-8'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 10 |\u001b[39m     expect(middleware)\u001b[33m.\u001b[39mtoContain(\u001b[32m'clerkMiddleware'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 11 |\u001b[39m     expect(middleware)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoContain(\u001b[32m'authMiddleware'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                            \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 12 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 13 |\u001b[39m\n     \u001b[90m 14 |\u001b[39m   it(\u001b[32m'should use createRouteMatcher for public routes'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (tests/migration.test.ts:11:28)\n\nTest Suites: 1 failed, 1 total\nTests:       1 failed, 2 passed, 3 total\nSnapshots:   0 total\nTime:        1.256 s\nRan all test suites.\n"
}